import{_ as e,o as l,c as t,Q as n}from"./chunks/framework.7d2df8c6.js";const s="/assets/mongodb-1.b467da78.png",o="/assets/mongodb-2.d2431ba3.png",a="/assets/mongodb-3.98ac6e22.png",p="/assets/netlify-1.c6c64abb.png",r="/assets/netlify-2.4f0d58e4.png",c="/assets/netlify-3.4f565e5d.png",i="/assets/netlify-4.1647e7f0.png",d="/assets/netlify-5.a29645d7.png",w=JSON.parse('{"title":"云函数部署","description":"","frontmatter":{},"headers":[],"relativePath":"backend.md","filePath":"backend.md","lastUpdated":null}'),y={name:"backend.md"},E=n(`<h1 id="云函数部署" tabindex="-1">云函数部署 <a class="header-anchor" href="#云函数部署" aria-label="Permalink to &quot;云函数部署&quot;">​</a></h1><table><thead><tr><th><div style="width:6em;">部署方式</div></th><th>推荐度</th><th>描述</th></tr></thead><tbody><tr><td><a href="#腾讯云一键部署">腾讯云一键部署</a></td><td>★☆☆☆☆</td><td>虽然方便，但是仅支持按量计费环境——也就是说，<strong>一键部署的环境，当免费资源用尽后，将会产生费用</strong>。且按量计费环境无法切换为包年包月环境。免费额度数据库读操作数只有 500 次 / 天，<strong>无法支撑 Twikoo 的运行需求</strong>。</td></tr><tr><td><a href="#腾讯云手动部署">腾讯云手动部署</a></td><td>★★☆☆☆</td><td>手动部署到腾讯云云开发环境，在中国大陆访问速度较快。需要付费购买环境才能部署。</td></tr><tr><td><a href="#腾讯云命令行部署">腾讯云命令行部署</a></td><td>★☆☆☆☆</td><td>仅针对有 Node.js 经验的开发者。</td></tr><tr><td><a href="#vercel-部署">Vercel 部署</a></td><td>★★★☆☆</td><td>适用于想要免费部署的用户，在中国大陆访问速度较慢甚至无法访问，绑定自己的域名可以提高访问速度。</td></tr><tr><td><a href="#railway-部署">Railway 部署</a></td><td>★★☆☆☆</td><td>有免费额度但不足以支持一个月连续运行，部署简单，适合全球访问。</td></tr><tr><td><a href="#zeabur-部署">Zeabur 部署</a></td><td>★☆☆☆☆</td><td>需要绑定支付宝或信用卡，部署简单，适合中国大陆访问，免费计划环境随时可能会被删除。</td></tr><tr><td><a href="#netlify-部署">Netlify 部署</a></td><td>★★★★☆</td><td>有充足的免费额度，中国大陆访问速度不错。</td></tr><tr><td><a href="#私有部署">私有部署</a></td><td>★★☆☆☆</td><td>适用于有服务器的用户，需要自行申请 HTTPS 证书。</td></tr><tr><td><a href="#私有部署-docker">私有部署 (Docker)</a></td><td>★★★☆☆</td><td>适用于有服务器的用户，需要自行申请 HTTPS 证书。</td></tr></tbody></table><h2 id="腾讯云一键部署" tabindex="-1">腾讯云一键部署 <a class="header-anchor" href="#腾讯云一键部署" aria-label="Permalink to &quot;腾讯云一键部署&quot;">​</a></h2><ol><li>点击以下按钮将 Twikoo 一键部署到云开发<br><a href="https://console.cloud.tencent.com/tcb/env/index?action=CreateAndDeployCloudBaseProject&amp;appUrl=https%3A%2F%2Fgithub.com%2Fimaegoo%2Ftwikoo&amp;branch=main" target="_blank" rel="noreferrer"><img src="https://main.qcloudimg.com/raw/67f5a389f1ac6f3b4d04c7256438e44f.svg" alt="部署到云开发"></a></li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noreferrer">环境-登录授权</a>，启用“匿名登录”</li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noreferrer">环境-安全配置</a>，将网站域名添加到“WEB安全域名”</li></ol><h2 id="腾讯云手动部署" tabindex="-1">腾讯云手动部署 <a class="header-anchor" href="#腾讯云手动部署" aria-label="Permalink to &quot;腾讯云手动部署&quot;">​</a></h2><p>如果您打算部署到一个现有的云开发环境，请直接从第 3 步开始。</p><ol><li>进入<a href="https://curl.qcloud.com/KnnJtUom" target="_blank" rel="noreferrer">云开发CloudBase</a>活动页面，滚动到“新用户专享”部分，选择适合的套餐，点击“立即购买”，按提示创建好环境。</li></ol><div class="tip custom-block"><p class="custom-block-title">提示</p><ul><li>推荐创建上海环境。如选择广州环境，需要在 <code>twikoo.init()</code> 时额外指定环境 <code>region: &quot;ap-guangzhou&quot;</code></li><li>环境名称自由填写</li><li>推荐选择计费方式<code>包年包月</code>，套餐版本<code>基础版 1</code>，超出免费额度不会收费</li><li>如果提示选择“应用模板”，请选择“空模板”</li></ul></div><ol start="2"><li>进入<a href="https://console.cloud.tencent.com/tcb/" target="_blank" rel="noreferrer">云开发控制台</a><br></li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noreferrer">环境-登录授权</a>，启用“匿名登录”</li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noreferrer">环境-安全配置</a>，将网站域名添加到“WEB安全域名”</li><li>进入<a href="https://console.cloud.tencent.com/tcb/scf/index" target="_blank" rel="noreferrer">环境-云函数</a>，点击“新建云函数”</li><li>函数名称请填写：<code>twikoo</code>，创建方式请选择：<code>空白函数</code>，运行环境请选择：<code>Nodejs 10.15</code>，函数内存请选择：<code>128MB</code>，点击“下一步”</li><li>清空输入框中的示例代码，复制以下代码、粘贴到“函数代码”输入框中，点击“确定”</li></ol><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">exports</span><span style="color:#E1E4E8;">.main </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;twikoo-func&#39;</span><span style="color:#E1E4E8;">).main</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">exports</span><span style="color:#24292E;">.main </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;twikoo-func&#39;</span><span style="color:#24292E;">).main</span></span></code></pre></div><ol start="8"><li>创建完成后，点击“twikoo&quot;进入云函数详情页，进入“函数代码”标签，点击“文件 - 新建文件”，输入 <code>package.json</code>，回车</li><li>复制以下代码、粘贴到代码框中，点击“保存并安装依赖”</li></ol><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{ </span><span style="color:#79B8FF;">&quot;dependencies&quot;</span><span style="color:#E1E4E8;">: { </span><span style="color:#79B8FF;">&quot;twikoo-func&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;1.6.22&quot;</span><span style="color:#E1E4E8;"> } }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{ </span><span style="color:#005CC5;">&quot;dependencies&quot;</span><span style="color:#24292E;">: { </span><span style="color:#005CC5;">&quot;twikoo-func&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;1.6.22&quot;</span><span style="color:#24292E;"> } }</span></span></code></pre></div><h2 id="腾讯云命令行部署" tabindex="-1">腾讯云命令行部署 <a class="header-anchor" href="#腾讯云命令行部署" aria-label="Permalink to &quot;腾讯云命令行部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><ul><li>请确保您已经安装了 <a href="https://nodejs.org/en/download/" target="_blank" rel="noreferrer">Node.js</a></li><li>请将命令、代码中“您的环境id”替换为您自己的环境id</li><li>第 7 步会弹出浏览器要求授权，需在有图形界面的系统下进行</li><li>请勿在 Termux 下操作。虽然可以部署成功，但是使用时会报错 <code>[FUNCTIONS_EXECUTE_FAIL] Error: EACCES: permission denied, open &#39;/var/user/index.js&#39;</code></li></ul></div><p>如果您打算部署到一个现有的云开发环境，请直接从第 3 步开始。</p><ol><li>进入<a href="https://curl.qcloud.com/KnnJtUom" target="_blank" rel="noreferrer">云开发CloudBase</a>活动页面，滚动到“新用户专享”部分，选择适合的套餐（一般 0 元套餐即可），点击“立即购买”，按提示创建好环境。</li><li>进入<a href="https://console.cloud.tencent.com/tcb/" target="_blank" rel="noreferrer">云开发控制台</a><br></li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/login" target="_blank" rel="noreferrer">环境-登录授权</a>，启用“匿名登录”</li><li>进入<a href="https://console.cloud.tencent.com/tcb/env/safety" target="_blank" rel="noreferrer">环境-安全配置</a>，将网站域名添加到“WEB安全域名”</li><li>克隆本仓库</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">git</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">clone</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">https://github.com/twikoojs/twikoo.git</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 或 git clone https://e.coding.net/imaegoo/twikoo/twikoo.git</span></span>
<span class="line"><span style="color:#79B8FF;">cd</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twikoo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">git</span><span style="color:#24292E;"> </span><span style="color:#032F62;">clone</span><span style="color:#24292E;"> </span><span style="color:#032F62;">https://github.com/twikoojs/twikoo.git</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 或 git clone https://e.coding.net/imaegoo/twikoo/twikoo.git</span></span>
<span class="line"><span style="color:#005CC5;">cd</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twikoo</span></span></code></pre></div><blockquote><p>如果您没有安装 Git，也可以从 <a href="https://github.com/twikoojs/twikoo/releases" target="_blank" rel="noreferrer">Release</a> 页面下载最新的 Source code<br> 如果您所在的地区访问 Github 速度慢，也可以尝试另一个仓库地址：<a href="https://imaegoo.coding.net/public/twikoo/twikoo/git" target="_blank" rel="noreferrer">https://imaegoo.coding.net/public/twikoo/twikoo/git</a></p></blockquote><ol start="6"><li>安装依赖项</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-g</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">yarn</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;"># 已安装 yarn 可以跳过此步</span></span>
<span class="line"><span style="color:#B392F0;">yarn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-g</span><span style="color:#24292E;"> </span><span style="color:#032F62;">yarn</span><span style="color:#24292E;"> </span><span style="color:#6A737D;"># 已安装 yarn 可以跳过此步</span></span>
<span class="line"><span style="color:#6F42C1;">yarn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span></span></code></pre></div><ol start="7"><li>授权云开发环境（此命令会弹出浏览器要求授权，需在有图形界面的系统下进行）</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yarn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">login</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yarn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">login</span></span></code></pre></div><ol start="8"><li>自动部署</li></ol><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yarn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">deploy</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">您的环境id</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yarn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">deploy</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">您的环境id</span></span></code></pre></div><h2 id="vercel-部署" tabindex="-1">Vercel 部署 <a class="header-anchor" href="#vercel-部署" aria-label="Permalink to &quot;Vercel 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Vercel 部署的环境需配合 1.4.0 以上版本的 twikoo.js 使用</p><p>默认域名 <code>*.vercel.app</code> 在中国大陆访问速度较慢甚至无法访问，绑定自己的域名可以提高访问速度</p></div><p><a href="https://www.bilibili.com/video/BV1Fh411e7ZH" target="_blank" rel="noreferrer">查看视频教程</a></p><ol><li>申请 <a href="https://www.mongodb.com/cloud/atlas/register" target="_blank" rel="noreferrer">MongoDB</a> 账号</li><li>创建免费 MongoDB 数据库，区域推荐选择 <code>AWS / N. Virginia (us-east-1)</code></li><li>在 Database Access 页面点击 Add New Database User 创建数据库用户，Authentication Method 选 Password，在 Password Authentication 下设置数据库用户名和密码，用户名和密码可包含数字和大小写字母，请勿包含特殊符号。点击 Database User Privileges 下方的 Add Built In Role，Select Role 选择 Atlas Admin，最后点击 Add User</li></ol><p><img src="`+s+'" alt=""></p><ol start="4"><li>在 Network Access 页面点击 Add IP Address，Access List Entry 输入 <code>0.0.0.0/0</code>（允许所有 IP 地址的连接），点击 Confirm</li></ol><p><img src="'+o+'" alt=""></p><ol start="5"><li>在 Database 页面点击 Connect，连接方式选择 Drivers，并记录数据库连接字符串，请将连接字符串中的 <code>&lt;username&gt;:&lt;password&gt;</code> 修改为刚刚创建的数据库 <code>用户名:密码</code></li></ol><p><img src="'+a+'" alt=""></p><ol start="6"><li>申请 <a href="https://vercel.com/signup" target="_blank" rel="noreferrer">Vercel</a> 账号</li><li>点击以下按钮将 Twikoo 一键部署到 Vercel<br></li></ol><p><a href="https://vercel.com/import/project?template=https://github.com/twikoojs/twikoo/tree/main/src/server/vercel-min" target="_blank" rel="noreferrer"><img src="https://vercel.com/button" alt=""></a></p><ol start="8"><li>进入 Settings - Environment Variables，添加环境变量 <code>MONGODB_URI</code>，值为前面记录的数据库连接字符串</li><li>进入 Deployments , 然后在任意一项后面点击更多（三个点） , 然后点击Redeploy , 最后点击下面的Redeploy</li><li>进入 Overview，点击 Domains 下方的链接，如果环境配置正确，可以看到 “Twikoo 云函数运行正常” 的提示</li><li>Vercel Domains（包含 <code>https://</code> 前缀，例如 <code>https://xxx.vercel.app</code>）即为您的环境 id</li></ol><h2 id="railway-部署" tabindex="-1">Railway 部署 <a class="header-anchor" href="#railway-部署" aria-label="Permalink to &quot;Railway 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Railway 部署的环境需配合 1.4.0 以上版本的 twikoo.js 使用</p><p>请一定要创建 MongoDB，不创建 MongoDB 也能正常使用，但重新部署后数据会丢失！</p></div><ol><li>在 <a href="https://railway.app/dashboard" target="_blank" rel="noreferrer">Railway</a> 申请并登录账号，点击 New Project - Provision MongoDB，名称随意</li><li>打开 <a href="https://github.com/twikoojs/twikoo-zeabur" target="_blank" rel="noreferrer">twikoojs/twikoo-zeabur</a> 点击 fork 将仓库 fork 到自己的账号下</li><li>回到 Railway 点击 New - GitHub Repo - Configure GitHub App - 授权 GitHub - 选择刚才 fork 的仓库，等待部署完成</li><li>点开环境卡片 - Variables - New Variable，左边输入 <code>PORT</code> 右边输入 <code>8080</code> 然后点 Add</li><li>同样地，添加 MongoDB 相关环境变量 - New Variable - Add Reference - MONGO* - Add，重复步骤以添加 <code>MONGOHOST</code>、<code>MONGOPASSWORD</code>、<code>MONGOPORT</code>、<code>MONGOUSER</code> 和 <code>MONGO_URL</code> 环境变量。</li><li>点开环境卡片 - Settings - Environment - Domains，绑定一个域名（例如 <code>mytwikoo.up.railway.app</code>）</li><li>到博客配置文件中配置 envId 为 <code>https://</code> 加域名（例如 <code>https://mytwikoo.up.railway.app</code>）</li></ol><h2 id="zeabur-部署" tabindex="-1">Zeabur 部署 <a class="header-anchor" href="#zeabur-部署" aria-label="Permalink to &quot;Zeabur 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Zeabur 部署的环境需配合 1.4.0 以上版本的 twikoo.js 使用</p><p>请一定要创建 MongoDB，不创建 MongoDB 也能正常使用，但重新部署后数据会丢失！</p></div><ol><li>在 <a href="https://dash.zeabur.com" target="_blank" rel="noreferrer">Zeabur</a> 申请并登录账号，点击部署新服务 - 部署其他服务 - 部署 MongoDB，名称随意</li><li>打开 <a href="https://github.com/twikoojs/twikoo-zeabur" target="_blank" rel="noreferrer">twikoojs/twikoo-zeabur</a> 点击 fork 将仓库 fork 到自己的账号下</li><li>回到 Zeabur 点击部署新服务 - 部署你的源代码 - 授权 GitHub - 选择刚才 fork 的仓库，名称随意</li></ol><blockquote><p><em>无需配置数据库连接字符串！ Zeabur 已自动配置</em></p></blockquote><ol start="4"><li>部署好后点开环境卡片 - 设置 - 域名，绑定一个域名（例如 <code>mytwikoo.zeabur.app</code>）</li><li>到博客配置文件中配置 envId 为 <code>https://</code> 加域名（例如 <code>https://mytwikoo.zeabur.app</code>）</li></ol><h2 id="netlify-部署" tabindex="-1">Netlify 部署 <a class="header-anchor" href="#netlify-部署" aria-label="Permalink to &quot;Netlify 部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>Netlify 部署的环境需配合 1.4.0 以上版本的 twikoo.js 使用</p><p>Netlify 免费等级（Functions Level 0）支持每月 125,000 请求次数和 100 小时函数计算时长</p></div><ol><li>申请 <a href="https://www.mongodb.com/cloud/atlas/register" target="_blank" rel="noreferrer">MongoDB</a> 账号</li><li>创建免费 MongoDB 数据库，区域推荐选择 <code>AWS / N. Virginia (us-east-1)</code></li><li>在 Database Access 页面点击 Add New Database User 创建数据库用户，Authentication Method 选 Password，在 Password Authentication 下设置数据库用户名和密码，用户名和密码可包含数字和大小写字母，请勿包含特殊符号。点击 Database User Privileges 下方的 Add Built In Role，Select Role 选择 Atlas Admin，最后点击 Add User</li></ol><p><img src="'+s+'" alt=""></p><ol start="4"><li>在 Network Access 页面点击 Add IP Address，Access List Entry 输入 <code>0.0.0.0/0</code>（允许所有 IP 地址的连接），点击 Confirm</li></ol><p><img src="'+o+'" alt=""></p><ol start="5"><li>在 Database 页面点击 Connect，连接方式选择 Drivers，并记录数据库连接字符串，请将连接字符串中的 <code>&lt;username&gt;:&lt;password&gt;</code> 修改为刚刚创建的数据库 <code>用户名:密码</code></li></ol><p><img src="'+a+'" alt=""></p><ol start="6"><li>申请并登录 <a href="https://app.netlify.com" target="_blank" rel="noreferrer">Netlify</a> 账号，创建一个 Team</li><li>打开 <a href="https://github.com/twikoojs/twikoo-netlify" target="_blank" rel="noreferrer">twikoojs/twikoo-netlify</a> 点击 fork 将仓库 fork 到自己的账号下</li><li>回到 Netlify，点击 Add new site - Import an existing project</li></ol><p><img src="'+p+'" alt=""></p><ol start="9"><li>点击 Deploy with GitHub，如果未授权 GitHub 账号，先授权，然后选择前面 fork 的 twikoo-netlify 项目</li></ol><p><img src="'+r+'" alt=""></p><ol start="10"><li>点击 Add environment variables - New variable，Key 输入 <code>MONGODB_URI</code>，Value 输入前面记录的数据库连接字符串，点击 Deploy twikoo-netlify</li></ol><p><img src="'+c+'" alt=""></p><ol start="11"><li>部署完成后，点击 Domain settings - 右侧 Options - Edit site name，可以设置属于自己的三级域名（<code>https://xxx.netlify.app</code>）</li></ol><p><img src="'+i+'" alt=""></p><ol start="12"><li>进入 Site overview，点击上方的链接，如果环境配置正确，可以看到 “Twikoo 云函数运行正常” 的提示</li></ol><p><img src="'+d+`" alt=""></p><ol start="13"><li>云函数地址（包含 <code>https://</code> 前缀和 <code>/.netlify/functions/twikoo</code> 后缀，例如 <code>https://xxx.netlify.app/.netlify/functions/twikoo</code>）即为您的环境 id</li></ol><h2 id="私有部署" tabindex="-1">私有部署 <a class="header-anchor" href="#私有部署" aria-label="Permalink to &quot;私有部署&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>私有部署的环境需配合 1.6.0 或以上版本的 twikoo.js 使用</p><p>私有部署对服务器系统没有要求，Windows、Ubuntu、CentOS、macOS 等常用系统均支持。</p><p>私有部署涉及终端操作、申请证书、配置反向代理或负载均衡等高级操作，如果对这些不太了解，建议优先选择其他方式部署。</p></div><ol><li>服务端下载安装 <a href="https://nodejs.org/zh-cn/" target="_blank" rel="noreferrer">Node.js</a></li><li>安装 Twikoo server: <code>npm i -g tkserver</code></li><li>根据需要配置环境变量，所有的环境变量都是可选的</li></ol><table><thead><tr><th>名称</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td><code>MONGODB_URI</code></td><td>MongoDB 数据库连接字符串，不传则使用 lokijs</td><td><code>null</code></td></tr><tr><td><code>MONGO_URL</code></td><td>MongoDB 数据库连接字符串，不传则使用 lokijs</td><td><code>null</code></td></tr><tr><td><code>TWIKOO_DATA</code></td><td>lokijs 数据库存储路径</td><td><code>./data</code></td></tr><tr><td><code>TWIKOO_PORT</code></td><td>端口号</td><td><code>8080</code></td></tr><tr><td><code>TWIKOO_THROTTLE</code></td><td>IP 请求限流，当同一 IP 短时间内请求次数超过阈值将对该 IP 返回错误</td><td><code>250</code></td></tr><tr><td><code>TWIKOO_LOCALHOST_ONLY</code></td><td>为<code>true</code>时只监听本地请求，使得 nginx 等服务器反代之后不暴露原始端口</td><td><code>null</code></td></tr><tr><td><code>TWIKOO_LOG_LEVEL</code></td><td>日志级别，支持 <code>verbose</code> / <code>info</code> / <code>warn</code> / <code>error</code></td><td><code>info</code></td></tr><tr><td><code>TWIKOO_IP_HEADERS</code></td><td>在一些特殊情况下使用，如使用了<code>CloudFlare CDN</code> 它会将请求 IP 写到请求头的 <code>cf-connecting-ip</code> 字段上，为了能够正确的获取请求 IP 你可以写成 <code>[&#39;headers.cf-connecting-ip&#39;]</code></td><td><code>[]</code></td></tr></tbody></table><ol start="4"><li>启动 Twikoo server: <code>tkserver</code></li><li>访问 <code>http://服务端IP:8080</code> 测试服务是否启动成功</li><li>配置前置代理实现 HTTPS 访问（可以用 Nginx、负载均衡或 Cloudflare 等）</li><li>到博客配置文件中配置 envId 为 <code>https://</code> 加域名（例如 <code>https://twikoo.yourdomain.com</code>）</li></ol><div class="tip custom-block"><p class="custom-block-title">提示</p><ol><li>Linux 服务器可以用 <code>nohup tkserver &gt;&gt; tkserver.log 2&gt;&amp;1 &amp;</code> 命令后台启动</li><li>数据默认在 data 目录，请注意定期备份数据</li></ol></div><h2 id="私有部署-docker" tabindex="-1">私有部署 (Docker) <a class="header-anchor" href="#私有部署-docker" aria-label="Permalink to &quot;私有部署 (Docker)&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">注意</p><p>私有部署的环境需配合 1.6.0 或以上版本的 twikoo.js 使用</p><p>私有部署涉及终端操作、申请证书、配置反向代理或负载均衡等高级操作，如果对这些不太了解，建议优先选择其他方式部署。</p></div><h3 id="docker" tabindex="-1">Docker <a class="header-anchor" href="#docker" aria-label="Permalink to &quot;Docker&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">docker</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--name</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">twikoo</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-e</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">TWIKOO_THROTTLE=</span><span style="color:#79B8FF;">1000</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">8080</span><span style="color:#9ECBFF;">:8080</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> \${PWD}</span><span style="color:#9ECBFF;">/data:/app/data</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">imaegoo/twikoo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">docker</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--name</span><span style="color:#24292E;"> </span><span style="color:#032F62;">twikoo</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-e</span><span style="color:#24292E;"> </span><span style="color:#032F62;">TWIKOO_THROTTLE=</span><span style="color:#005CC5;">1000</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">8080</span><span style="color:#032F62;">:8080</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> \${PWD}</span><span style="color:#032F62;">/data:/app/data</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">imaegoo/twikoo</span></span></code></pre></div><h3 id="docker-compose" tabindex="-1">Docker Compose <a class="header-anchor" href="#docker-compose" aria-label="Permalink to &quot;Docker Compose&quot;">​</a></h3><div class="language-yml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#85E89D;">version</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&#39;3&#39;</span></span>
<span class="line"><span style="color:#85E89D;">services</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#85E89D;">twikoo</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">image</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">imaegoo/twikoo</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">container_name</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">twikoo</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">restart</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">unless-stopped</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">ports</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">8080:8080</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">environment</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#85E89D;">TWIKOO_THROTTLE</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">1000</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#85E89D;">volumes</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">      - </span><span style="color:#9ECBFF;">./data:/app/data</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#22863A;">version</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&#39;3&#39;</span></span>
<span class="line"><span style="color:#22863A;">services</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#22863A;">twikoo</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">image</span><span style="color:#24292E;">: </span><span style="color:#032F62;">imaegoo/twikoo</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">container_name</span><span style="color:#24292E;">: </span><span style="color:#032F62;">twikoo</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">restart</span><span style="color:#24292E;">: </span><span style="color:#032F62;">unless-stopped</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">ports</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">8080:8080</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">environment</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#22863A;">TWIKOO_THROTTLE</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">1000</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#22863A;">volumes</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">      - </span><span style="color:#032F62;">./data:/app/data</span></span></code></pre></div>`,75),h=[E];function u(g,k,b,m,f,v){return l(),t("div",null,h)}const C=e(y,[["render",u]]);export{w as __pageData,C as default};
